<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>glip: Cypress FX3 Firmware</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">glip
   &#160;<span id="projectnumber">0.1.0-dev</span>
   </div>
   <div id="projectbrief">The Generic Logic Interfacing Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>GLIP&#160;Introduction</span></a></li>
      <li><a href="examples.html"><span>Demos</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li><a href="download.html"><span>Download</span></a></li>
      <li><a href="contact.html"><span>Contact</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__backend__cypressfx3-fw.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Cypress FX3 Firmware<div class="ingroups"><a class="el" href="group__backend.html">Backends</a> &raquo; <a class="el" href="group__backend__cypressfx3.html">Cypress FX3</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The Cypress FX3 chip needs firmware for its configuration. We use the chip in the "Slave FIFO" mode which only forwards data between USB and a 32 bit wide FIFO interface.</p>
<h2>Flashing the FX3 firmware</h2>
<p>Currently, the firmware part on the Fx3 is a bit messy, as a Cypress vendor tool is required. The following steps flash the firmware.</p>
<ul>
<li>Download the "EZ-USB FX3 SDK v1.3.3 for Linux" at <a href="http://www.cypress.com/file/139281">http://www.cypress.com/file/139281</a>. A registration is required.</li>
<li>Install the cyusb_linux GUI application</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;mkdir fx3-install</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cd fx3-install</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;tar -xf path/to/downloaded/FX3_SDK_Linux_v1.3.3.tar.gz</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;tar -xf cyusb_linux_1.0.4.tar.gz</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;cd cyusb_linux_1.0.4</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;sudo ./install.sh</div>
</div><!-- fragment --><ul>
<li>Unplug the FX3 board from the FPGA (if it is currently connected).</li>
<li>Disconnect (if already connected) the USB cable from the FX3 board.</li>
<li>Set the jumper J4 (PMODE) on the board to bring the device into programming mode.</li>
<li>Connect the FX3 board over the USB cable to your PC.</li>
<li>Run the cyusb_linux application to flash the firmware.</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;LD_LIBRARY_PATH=/usr/local/lib cyusb_linux</div>
</div><!-- fragment --><ul>
<li>In the GUI, select the correct device in the "List of devices" at the top. Verify that it the "Device Type" is "FX3".</li>
<li>Select the "Program" tab and there select the "FX3" subtab.</li>
<li>Select one of the "Download to -&gt;" options. If you want to flash the firmware to the FX3 permanently, choose "I2C EEPROM". (The recommended default.) If you are debugging the firmware you can also choose "RAM". (If you choose "RAM", you need to re-flash whenever you disconnect the board from the power supply.)</li>
<li>Click on "Select File" and choose the firmware file from the GLIP source directory: $GLIP/src/backend_cypressfx3/fw/cyfxslfifosync32.img</li>
<li>Click on "Start Download" to flash the firmware to the FX3.</li>
<li>If you've chosen the "I2C EEPROM" option, remove the jumper J4 (PMODE) again to let the FX3 boot with the firmware from EEPROM.</li>
<li>Close the cyusb_linux application again to free the device for other applications.</li>
</ul>
<h2>Power cycle considerations</h2>
<p>When powering (or resetting) the FX3 board the boot mode is determined by the PMODE pins. These pins are also connected to the FPGA board. Hence, the FX3 must either be disconnected from the FMC connector while being powered/resetted, or the FPGA must already be programmed with the PMODE pins set to 'z1z' (which is done in the demo projects).</p>
<p>With the PMODE jumper (J4) set, the FX3 will boot from USB and can be programmed. Without the jumper it will boot from the EEPROM.</p>
<h2>Building the Firmware</h2>
<p>The firmware that is used with the glip is based on the 'FX3 Slave FIFO Interface' example provided by Cypress. To build the firmware from source code follow these steps (under Linux):</p>
<ul>
<li>Download and install the Cypress EZ-USB FX3 SDK from <a href="http://www.cypress.com/documentation/software-and-drivers/ez-usb-fx3-software-development-kit">http://www.cypress.com/documentation/software-and-drivers/ez-usb-fx3-software-development-kit</a></li>
<li>Download the 'FX3 Slave FIFO Interface' example from <a href="http://www.cypress.com/documentation/application-notes/an65974-designing-ez-usb-fx3-slave-fifo-interface">http://www.cypress.com/documentation/application-notes/an65974-designing-ez-usb-fx3-slave-fifo-interface</a></li>
<li>Copy the directory "/FX3 Firmware/SlaveFifoSync" from the example to the directory $FX3_INSTALL_PATH/firmware/slavefifo_examples</li>
<li>Delete the subdirectories "Debug" and "Release" in "SlaveFifoSync"</li>
<li>Copy $GLIP/src/backend_cypressfx3/fw/SlaveFifoSync.patch to $FX3_INSTALL_PATH/firmware/slavefifo_examples/SlaveFifoSync and apply the patch</li>
<li>Now you can import the project to the EZ-USB FX3 SDK and build the firmware </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu May 4 2017 22:04:12 for glip by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
