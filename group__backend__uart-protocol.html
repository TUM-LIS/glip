<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>glip: UART Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">glip
   &#160;<span id="projectnumber">0.1.0-dev</span>
   </div>
   <div id="projectbrief">The Generic Logic Interfacing Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>GLIP&#160;Introduction</span></a></li>
      <li><a href="examples.html"><span>Demos</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li><a href="download.html"><span>Download</span></a></li>
      <li><a href="contact.html"><span>Contact</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__backend__uart-protocol.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">UART Protocol<div class="ingroups"><a class="el" href="group__backend.html">Backends</a> &raquo; <a class="el" href="group__backend__uart.html">UART</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>Standard UART does not have any out-of-band signaling, meaning we cannot use control signals. The glip interface requires a reset signal to reset the logic without board interaction. This signal needs to be controlled by in-band signaling.</p>
<h2>In-Band Signaling </h2>
<p>UART is one byte per transfer and we obviously want to use the full byte in the default case. Hence one word is defined as a special word. When this word needs to be transmitted, it needs to be transferred twice. If the second word is not the same, that is a control message. We use <code>0xfe</code> as <code>0x00</code> and <code>0xff</code> along with lower numbers are safely assumed to be in the stream at a higher rate.</p>
<p>Example user data stream: </p><pre class="fragment">0xaf 0xfe 0x00 0xff
</pre><p>UART data stream: </p><pre class="fragment">0xaf 0xfe 0xfe 0x00 0xff 
</pre><h2>Credit-based Flow Control </h2>
<p>The reset can happen at anytime, and especially when the input FIFO is full as the user logic has deadlocked or similar. The problem now is how to transfer a control word into the device when the input is blocked. Hence, we need credit-based flow control, where the host gets clearance from the device to send a certain amount of data. With each transfer the host loses one of the credits and it needs to wait for new credit from the device. This credit also needs to be transfered in-band, meaning that we apply the same in-band signaling scheme described above.</p>
<p>One may think it is safe to not implement flow control in the other direction (logic-&gt;host), but to have a robust it is also required to implement credit-based flow control there. In glip we don't make any assumptions about when data is read and how input and output data relate. Hence the back-pressure from the input may block the credit messages and a deadlock in the user code may occur.</p>
<p>Summarizing, we need credit-based flow control in both directions.</p>
<h2>Protocol Datagrams </h2>
<p>From logic to host we have the following protocol datagrams:</p>
<table class="doxtable">
<tr>
<th>word 0 </th><th>word 1 </th><th>Description  </th></tr>
<tr>
<td><code>{credit[14:8],1}</code> </td><td><code>credit[7:0]</code> </td><td>Credit update </td></tr>
</table>
<p>From host to logic we have the following protocol datagrams:</p>
<table class="doxtable">
<tr>
<th>word 0 </th><th>word 1 </th><th>Description  </th></tr>
<tr>
<td><code>{0,credit[13:8],1}</code> </td><td><code>credit[7:0]</code> </td><td>Credit update </td></tr>
<tr>
<td><code>100000r1</code> </td><td>- </td><td>Set logic rst pin to <code>r</code> </td></tr>
<tr>
<td><code>100001r1</code> </td><td>- </td><td>Set comm rst pin to <code>r</code> </td></tr>
</table>
<p>The credit datagrams are exchanged as follows:</p>
<p>For the <em>ingress</em> path (host to logic), the credit is sent right after reset of the communication. This reset is usually a board reset, but most importantly when connecting from the host. The communication controller then observes the data stream and updates the credit each time it falls below the 50% threshold. This gives the host sufficient time to actually receive this message before running out of credits, and on the other hand does not imply too many messages.</p>
<p>For the <em>egress</em> path (logic to host), the host gives all initial credit in a few tranches to the FPGA. It then also observes the incoming data and sends a new credit of the maximum number that can be transferred in one datagram (<code>0x3fff</code>) once the remaining credit falls below the threshold of <code>HOST_BUFFER_SIZE - 0x3fff</code>.</p>
<p>The <code>logic_rst</code> pin is set on demand by the user application. The communications reset pin is used by the communication controller to reset itself to a defined state. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu May 4 2017 22:04:12 for glip by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
