<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>glip: JTAG Wire Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">glip
   &#160;<span id="projectnumber">0.1.0-dev</span>
   </div>
   <div id="projectbrief">The Generic Logic Interfacing Project</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>GLIP&#160;Introduction</span></a></li>
      <li><a href="examples.html"><span>Demos</span></a></li>
      <li><a href="modules.html"><span>Documentation</span></a></li>
      <li><a href="download.html"><span>Download</span></a></li>
      <li><a href="contact.html"><span>Contact</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__backend__jtag-protocol.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">JTAG Wire Protocol<div class="ingroups"><a class="el" href="group__backend.html">Backends</a> &raquo; <a class="el" href="group__backend__jtag.html">JTAG</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<dl class="section note"><dt>Note</dt><dd>This section requires some familarity with JTAG and the JTAG state machine. If this sounds unfamiliar, please read up on those topics first before returning to this documentation.</dd></dl>
<p>GLIP uses a custom data transmission protocol on top of JTAG to achieve reasonable performance. Two main factors limit the throughput over JTAG:</p>
<ul>
<li>going through the JTAG state machine between data shifts</li>
<li>round-trip delays induced by standard JTAG adapters. The common FT2232-based JTAG adapters wrap each JTAG command in a USB transmission, which can create significant round-trip latencies.</li>
</ul>
<p>Considering those factors, the central idea of the GLIP JTAG protocol is the usage of very large transmissions, i.e. a very long shift register to achieve good performance. All communication is done in the JTAG data shift state (dshift). To further reduce the overhead introduced by round-trip delays, we chose a flow control protocol based on the opportunistic sending of data, which is then acknowledged by the FPGA or (if not acknowledged) retransmitted by the host.</p>
<p>Three types of communication messages are defined, which are described below.</p>
<h2>Configuration Discovery </h2>
<p>Before starting the communication between the host and the target, the host needs to get the values of some configuration parameters, passed to <code>glip_jtag_toplevel</code> at synthesis time.</p>
<p>Therefore, communication starts with a configuration discovery transmission, which is depicted below: </p><pre class="fragment">word  0        1            2
bit   15     0 15         0 15        0
     +--------+------------+-----------+
req  | 0xFFFF |   0x0000   |  0x0000   |
     +--------+------------+-----------+
     +--------+------------+-----------+
resp | 0x0000 | WORD_WIDTH | NUM_WORDS |
     +--------+------------+-----------+
</pre><ul>
<li><code>WORD_WIDTH</code> are the number of bits in a transmitted data word</li>
<li><code>NUM_WORDS</code> is the log2(size) of the receive buffer in words. The number of words is calculated as (1 &lt;&lt; NUM_WORDS).</li>
</ul>
<h2>Side Channel Communication </h2>
<p>GLIP supports the transmission of side-channel data in addition to the FIFO payload data. This data is transferred in the same way as the configuration discovery packet.</p>
<pre class="fragment">word  0        1            2
bit   15     0 15         0 15        0
     +--------+------------+-----------+
req  | 0xFFFF |     SC     |  0x0000   |
     +--------+------------+-----------+
     +--------+------------+-----------+
resp | 0x0000 |   ignored  |  ignored  |
     +--------+------------+-----------+
</pre><p><code>SC</code> is a bitfield of side-channel data.</p><ul>
<li><code>SC[0]</code>: logic reset (<code>ctrl_logic_reset</code>)</li>
</ul>
<h2>Data Communication </h2>
<p>The basic idea of the data communication is the following.</p>
<ul>
<li>The host sends data in words, the target acknowledges the number of words written into the output FIFO. Words which are not acknowledged are retransmitted by the host.</li>
<li>The host always guarantees enough buffer space for requested words from the FPGA. Therefore, no retransmissions occur on read transfers. (Buffer space on the PC is not as expensive as it is on an FPGA.)</li>
</ul>
<p>The word width (<code>WW</code> in the following diagram) is equal to the FIFO width on the logic side.</p>
<pre class="fragment">word  0             1             2            n+1          n+2            n+3
bit   WW-1        0 WW-1        0 WW-1      0  WW-1       0 WW-1         0 WW-1         0
     +-------------+-------------+-----------+/+-----------+--------------+--------------+
req  | WR_REQ_SIZE | RD_REQ_SIZE | WR_WORD_1 |/| WR_WORD_n |    0x0000    |    0x0000    |
     +-------------+-------------+-----------+/+-----------+--------------+--------------+
     +-------------+-------------+-----------+/+-----------+--------------+--------------+
resp |    0x0000   |    0x0000   | RD_WORD_1 |/| RD_WORD_n | WR_RESP_SIZE | RD_RESP_SIZE |
     +-------------+-------------+-----------+/+-----------+--------------+--------------+
</pre><ul>
<li><code>WR_REQ_SIZE</code>: Number of words that are valid in the request, i.e. that should be written into the target-side FIFO. Setting this field to all-one (0xFF..FF) is not allowed, since this value has special meaning.</li>
<li><code>RD_REQ_SIZE</code>: Number of words that are requested by the host for transmission. The target is free to send less data.</li>
<li><code>WR_RESP_SIZE</code>: Number of words that have been successfully written into the target's FIFO, i.e. they are acknowledged by the target. All words which are not acknowledged need to be resent.</li>
<li><code>RD_RESP_SIZE</code>: Number of valid words in the response from the target that should be written to the host-side FIFO (up to <code>RD_REQ_SIZE</code> words).</li>
<li><code>n</code> is the number of payload words (each being <code>WW</code> bit wide). It is equal to <code>MAX(WR_REQ_SIZE, RD_REQ_SIZE)</code>. <code>n</code> can be at most <code>2*WW - 2</code>, since the 0xFF...FF value inside <code>WR_REQ_SIZE</code> is reserved.</li>
<li><code>WR_WORD_x</code> are the data words sent to the target</li>
<li><code>RD_WORD_x</code> are the data words received from the target</li>
<li>The data fields can be empty (but must still be sent, of course). If empty, they should be set to 0x0000. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Jan 3 2016 15:08:21 for glip by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
